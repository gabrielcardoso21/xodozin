# Configuração Nixpacks para Railway
# Este arquivo deve estar no diretório xodozin/
# Se Root Directory estiver configurado como 'xodozin', este arquivo será usado

providers = ["node"]

[variables]
NODE_VERSION = "20"
# Cache de dependências para builds mais rápidos
YARN_CACHE_FOLDER = "/tmp/.yarn-cache"
# Aumentar limite de memória do Node.js para build do frontend
# Reduzido para 2GB para evitar OOM Killer no Railway
NODE_OPTIONS = "--max-old-space-size=2048"

[phases.setup]
cmds = [
  "echo 'Building Medusa project'",
  "mkdir -p /tmp/.yarn-cache"
]

[phases.install]
cmds = [
  # Removido --frozen-lockfile temporariamente para permitir atualização do lockfile
  "yarn install --cache-folder /tmp/.yarn-cache"
]

[phases.build]
cmds = [
  "yarn build:skip-if-exists"
]

[start]
cmd = "medusa db:migrate && medusa start"

